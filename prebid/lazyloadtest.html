<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Lazy loading in GPT</title>

    <script>googletag = window.googletag || {cmd: []};</script>
    <script async src="//www.googletagservices.com/tag/js/gpt.js"></script>

    <script>
      var topSlot, bottomSlot; +       googletag.cmd.push(function() {
        topSlot = googletag.defineSlot('/1001824/prebid_test3', [300, 250], 'topAd').addService(googletag.pubads());
        bottomSlot = googletag.defineSlot('/1001824/prebid_test2', [728, 90], 'bottomAd').addService(googletag.pubads());
        googletag.pubads().disableInitialLoad();
        googletag.enableServices();
      });
    </script>
  </head>
  <body>
    <h1>Lazy loading in GPT</h1>

    <div id="topAd" style="width: 300px; height: 250px">
      <script>
        // Load the top ad as soon as possible. No lazy loading required here.
        googletag.cmd.push(function() {
          googletag.display('topAd');
          googletag.pubads().refresh();
        });
      </script>
    </div>

    <!-- Large div to make the bottom ad go below the fold. -->
    <div id="veryLongDiv" style="width: 200px; height: 1000px">intentionally left blank</div>

    <div id="bottomAd" style="width: 728px; height: 90px">
      <script>
        googletag.cmd.push(function() {
          // This will only register the slot. Ad will be fetched only 
          // when refresh is called.
          googletag.display('bottomAd');
        });
      </script>
    </div>

    <script>
      // Refresh the bottom slot when it is about to come into view.
      var refreshed = false;

      // Value of scrollY at which the ad is about to come into view.
      var adAlmostVisibleScrollValue = 300;

      // Warning: This is a sample implementation. Listening to onscroll without 
      // any throttling might not be very efficient.
      var listener = function() {
        if (window.scrollY >= adAlmostVisibleScrollValue && !refreshed) {
          googletag.cmd.push(function() {
            googletag.pubads().refresh([bottomSlot]);
          });
          // Refresh the ad only once.
          refreshed = true;

          // Remove the listener now.
          window.removeEventListener('scroll', listener);
        }
      }
      window.addEventListener('scroll', listener);
    </script>
    <br/>
      </body>
</html>